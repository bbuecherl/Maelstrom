/**
 * Maelstrom v0.0.1-1403282351
 * https://github.com/bbuecherl/Maelstrom/
 * by Bernhard Buecherl http://bbuecherl.de/
 * License: MIT http://bbuecherl.mit-license.org/
 */
!function(a,b){"function"==typeof define&&define.amd?define(["Maelstrom"],b):a.Maelstrom=b()}(this,function(){"use strict";"undefined"!=typeof"".trim&&(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF]+|[\s\uFEFF]+$/g,"")}),Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(a,b){var c=this[a],d=c,e=function(){return d},f=function(e){return c=d,d=b.call(this,a,c,e)};delete this[a]&&Object.defineProperty(this,a,{get:e,set:f,enumerable:!0,configurable:!0})}}),Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(a){var b=this[a];delete this[a],this[a]=b}}),Array.prototype.min=function(){return Math.min.apply(this,this)},String.prototype.startsWith=String.prototype.startsWith||function(a,b){return b=b||0,this.slice(b,b+a.length)==a},String.prototype.contains=String.prototype.contains||function(){return-1!==String.prototype.indexOf.apply(this,arguments)};var a=function(a){for(var b=0,c=a.length;c>b;++b)if(" "!=a[b]&&"	"!=a[b])return b;return a.length},b=function(a){return a.split(/#|\.|\(|\{| /g)},c=function(a,b){var c=a.indexOf(b);return-1!=c?[a.slice(0,c),a.slice(c+b.length)]:!1},d=function(a,b){for(var c=b.split("."),d=0;d<c.length;++d){if("undefined"==typeof a[c[d]])return!1;a=a[c[d]]}return!0},e=function(a,b){for(var c=b.split("."),d=0;d<c.length;++d)a=a[c[d]];return a},f=function(a){for(var b,c={},d=[],e=0,f=0,g=!1;e<a.length;++e)'"'==a[e]&&(g=!g),","!=a[e]||g||(d.push(a.slice(f,e).trim()),f=e+1);for(d.push(a.slice(f)),e=0;e<d.length;++e)0!==d[e].length&&(f=d[e].split("="),b=f[1].trim(),c[f[0].trim()]=b.slice(1,b.length-1));return c},g=["br","hr","input","img","meta","link","wbr","area"],h=function(a){return"undefined"==typeof a?!1:-1!=g.indexOf(a)},i=function(a){return"[object Array]"===Object.prototype.toString.call(a)},j=function(){for(var a={},b=0,c=arguments.length;c>b;b++)if("object"==typeof arguments[b]&&null!==arguments[b])for(var d in arguments[b])arguments[b].hasOwnProperty(d)&&!a.hasOwnProperty(d)&&(a[d]=arguments[b][d]);return a},k=function(a,b){this.name=a,this.message=b},l=document,m=l.createElement.bind(l),n=l.createDocumentFragment.bind(l),o=l.createTextNode.bind(l),p="",q="",r="[[$",s="]]",t=function(a,b,c,d,e,f){return b.startsWith("each")?a.push(new x(b.slice(4),f,d,e)):b.startsWith("if")||b.startsWith("else")||a.push(new v(b,f,d,e)),a},u=function(a,b,c){for(var d,e=c.o.min(),f=[],g=[],h=[],i=0,j=-1,k=0;k<c.l.length;++k)e==c.o[k]?k!==i&&(t(h,c.l[i],c.o[i],a,b,{l:f,o:g},d,j),f=[],g=[],i=k):(f.push(c.l[k]),g.push(c.o[k]));return t(h,c.l[i],c.o[i],a,b,{l:f,o:g},d,j)},v=function(a,d,e,g){this.line=a,this.root=g,this.parent=e,this.vars={},this.derived=[];var i,j,k,l,m,n,o;if(this.line.startsWith("logic"))this.node="logic",d.l.length>0&&(this.childs=u(this,g,d)),j="";else if(this.line.startsWith("|"))this.node="|",j=this.line.slice(1);else{for(d.l.length>0&&(this.childs=u(this,g,d)),this.line.startsWith("#")||this.line.startsWith(".")?(j=this.line,this.node="DIV"):(i=b(this.line),j=this.line.slice(i[0].length),this.node=i[0].toUpperCase()),this.classes="",this.id="";j.length>0;)if(j.startsWith("#"))i=b(j.slice(1)),j=j.slice(i[0].length+1).trim(),this.id=i[0];else{if(!j[0].startsWith("."))break;i=b(j.slice(1)),j=j.slice(i[0].length+1).trim(),this.classes+=" "+i[0]}if(this.attrs={},j.startsWith("(")){for(l=1;l<j.length&&!j.startsWith(")",l);++l);i=j.slice(1,l).trim(),j=j.slice(l+1),k=f(i);for(m in k)k[m].contains(r)?(n=k[m].split(r)[1].split(s)[0],(this.vars[n]=this.vars[n]||[]).push({type:v.VType.ATTRIBUTE,link:m,inside:k[m]})):this.attrs[m]=k[m]}if(this.styles={},j.startsWith("{")){for(l=1;l<j.length&&!j.startsWith("}",l);++l);i=j.slice(1,l+1).replace("}","").trim(),j=j.slice(l+2),k=f(i);for(var t in k)k[t].contains(r)?(n=k[t].split(r)[1].split(s)[0],(this.vars[n]=this.vars[n]||[]).push({type:v.VType.STYLE,link:t,inside:k[t]})):this.styles[t]=k[t]}}if(j.startsWith(" ")&&(j=j.slice(1)),j.length>0&&!h(o)){var w=0;for(this.contents="";i=c(j,r);)this.contents+=i[0],i=c(i[1],s),(this.vars[i[0]]=this.vars[i[0]]||[]).push({type:v.VType.CONTENT,inside:w++}),this.contents+=p+r+i[0]+s+q,j=i[1];this.contents+=j}for(var x in this.vars)g.on(x,this.render.bind(this))};v.prototype={render:function(a,b){if("undefined"==typeof a);else if(this.vars.hasOwnProperty(a))for(var c,d,e=0,f=this.vars[a];e<f.length;++e)if(d=f[e].link,f[e].type==v.VType.ATTRIBUTE)for(this.attrs[d]=f[e].inside.replace(r+a+s,b),c=0;c<this.derived.length;++c)this.derived[c].setAttribute(d,this.attrs[d]);else if(f[e].type==v.VType.STYLE)for(this.styles[d]=f[e].inside.replace(r+a+s,b),c=0;c<this.derived.length;++c)this.derived[c].setStyle(d,this.styles[d]);else if(f[e].type==v.VType.CONTENT){var g=this.contents,h=p+g.split(p)[f[e].inside+1].split(q)[0]+q;for(this.contents=g.replace(h,p+b+q),c=0;c<this.derived.length;++c)this.derived[c].setContent(g.replace(h,p+b+q))}},build:function(a){var b=new w(this,a);return this.derived.push(b),b.get()}},v.VType={ATTRIBUTE:1,STYLE:2,CONTENT:3};var w=function(a,b){if(this.processor=a,"|"==a.node||"logic"==a.node)this.domElement=n();else{this.domElement=m(a.node),a.id.length>0&&(this.domElement.id=a.id),a.classes.length>0&&(this.domElement.className=a.classes.trim());for(var c in a.attrs)this.setAttribute(c,a.attrs[c]);for(c in a.styles)this.setStyle(c,a.styles[c])}if("undefined"!=typeof a.contents&&(this.textNode=o(""),this.setContent(a.contents),this.domElement.appendChild(this.textNode)),this.redefine(b),"undefined"!=typeof a.childs)for(var d=0;d<a.childs.length;++d)this.domElement.appendChild(a.childs[d].build(b))};w.prototype={redefine:function(a){this.defined=j(a,this.defined);var b,c,d,e;for(var f in a)if(this.processor.vars.hasOwnProperty(f))for(b=a[f],c=0,d=this.processor.vars[f];c<d.length;++c)if(e=d[c].link,d[c].type==v.VType.ATTRIBUTE)this.setAttribute(e,d[c].inside.replace(r+f+s,b));else if(d[c].type==v.VType.STYLE)this.setStyle(e,d[c].inside.replace(r+f+s,b));else if(d[c].type==v.VType.CONTENT){var g=this.contents,h=p+g.split(p)[d[c].inside+1].split(q)[0]+q;this.setContent(g.replace(h,p+b+q))}},get:function(){return this.domElement},setContent:function(a){this.contents=a,this.textNode.textContent=a.replace(p,"").replace(q,"")},setAttribute:function(a,b){this.domElement.setAttribute(a,b)},setStyle:function(a,b){a=a.split("-");for(var c=0;c<a.length;++c)0!==c&&(a[c]=a[c].slice(0,1).toUpperCase()+a[c].slice(1));this.domElement.style[a.join("")]=b}};var x=function(a,b,d,e){var f,g=c(a," in ");this.root=e,this.data=b,this.derived=[],this.childs=[],this.valueIterator=null,this.indexIterator=null,this.data.l.unshift("logic "),this.data.o.unshift(0),this.childProcessor=u(this,this.root,this.data)[0],g[0].contains(",")?(f=g[0].split(","),this.valueIterator=f[0].trim(),this.indexIterator=f[1].trim()):this.valueIterator=g[0].trim(),g[1].contains(r)?(this.logic=g[1].split(r)[1].split(s)[0],e.on(this.logic,function(a,b){this.obj="string"==typeof b?JSON.parse(b):b,this.render()}.bind(this))):(this.obj=JSON.parse(g[1].trim()),this.render())};x.prototype={build:function(a){for(var b=new y(this,a),c=0;c<this.obj.length;++c)b.addChild(this.childs[c]);return this.derived.push(b),b.get()},render:function(){if(i(this.obj))for(var a,b=0;b<this.obj.length;++b)for(this.childs.length==b&&(this.childs[b]={}),null!==this.indexIterator&&(this.childs[b][this.indexIterator]=b),this.childs[b][this.valueIterator]=this.obj[b],a=0;a<this.derived.length;++a)this.derived[a].renderCount<=b?this.derived[a].addChild(this.childs[b]):this.derived[a].redefineChild(b,this.childs[b]);else if("object"==typeof this.obj&&null!==this.obj);else{if("number"!=typeof this.obj||!isFinite(this.obj))throw new k("TypeError","EachProcessor can iterate over arrays, objects and numbers only");{parseInt(this.obj,10)}}}};var y=function(a,b){this.childs=[],this.childProcessor=a.childProcessor,this.renderCount=0,this.domElement=n(),this.redefine(b)};y.prototype={redefine:function(a){this.defined=j(a,this.defined)},get:function(){return this.domElement},addChild:function(a){++this.renderCount,this.childs.length<this.renderCount?this.childs.push(this.childProcessor.build(a)):this.childs[this.renderCount-1].redefine(a),this.domElement.appendChild(this.childs[this.renderCount-1])},redefineChild:function(a,b){a<this.renderCount&&this.childs[a].redefine(b)},removeChild:function(){0!==this.renderCount&&(--this.renderCount,this.domElement.removeChild(this.childs[this.renderCount].get()))}};var z=function(b){for(var c=[],d=[],e=b.split("\n"),f=0,g=e.length,h=0,i=-1;g>f;++f)h=a(e[f]),e[f].startsWith("//",h)?i=h:h!==e[f].length&&(-1==i?!0:i>=h)&&(c.push(e[f].trim()),d.push(h),i=-1);this.lines={l:c,o:d},this.listeners={},this.subscription=!1,this.childs=0!==c.length?u(this,this,this.lines):[]};z.prototype={append:function(a){if("undefined"==typeof this.frag){this.frag=n();for(var b=0,c=this.childs.length;c>b;++b)this.frag.appendChild(this.childs[b].build())}return this.childs.length>0&&a.appendChild(this.frag),this},remove:function(a){return"undefined"!=typeof this.frag&&a.removeChild(this.frag),this},on:function(a,b){return this.listeners.hasOwnProperty(a)||(this.listeners[a]=[]),this.listeners[a].push(b),this},off:function(a,b){if(this.listeners.hasOwnProperty(a)){var c=this.listeners[a].indexOf(b);-1!=c&&delete this.listeners[a][c]}return this},trigger:function(a,b){if(this.listeners.hasOwnProperty(a))for(var c=0;c<this.listeners[a].length;++c)this.listeners[a][c](a,b);return this},render:function(a){for(var b in this.listeners)d(a,b)&&this.trigger(b,e(a,b));return this},subscribe:function(a){var b,c,d,e,f;if(this.subscription)for(var g in this.listeners){for(f=g.split("."),b=this.subscription,c=this.subscription,d=0;d<f.length;++d){if(!c.hasOwnProperty(f[d])){e=!1;break}b=c,e=!0,c=c[f[d]]}e&&b.unwatch(f[f.length-1])}if(this.subscription=a,this.subscription){var h=function(a,c,d,e){b.watch(c,function(a,b,c){return this.trigger(d,c),c}.bind(a)),a.trigger.apply(a,[d,e])};for(var i in this.listeners){for(f=i.split("."),b=this.subscription,c=this.subscription,d=0;d<f.length;++d){if(!c.hasOwnProperty(f[d])){e=!1;break}b=c,e=!0,c=c[f[d]]}e&&h(this,f[f.length-1],i,b[f[f.length-1]])}}return this},unsubscribe:function(){return this.subscribe(!1)}};var A={compile:function(a,b){var c=new z(a);return"undefined"!=typeof b&&c.subscribe(b),c}};return A});