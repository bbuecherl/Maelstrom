/**
 * Maelstrom v0.0.1-1403252001
 * https://github.com/bbuecherl/Maelstrom/
 * by Bernhard Buecherl http://bbuecherl.de/
 * License: MIT http://bbuecherl.mit-license.org/ */
!function(a,b){"function"==typeof define&&define.amd?define(["Maelstrom"],b):a.Maelstrom=b()}(this,function(){"use strict";"undefined"!=typeof"".trim&&(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF]+|[\s\uFEFF]+$/g,"")}),Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(a,b){var c=this[a],d=c,e=function(){return d},f=function(e){return c=d,d=b.call(this,a,c,e)};delete this[a]&&Object.defineProperty(this,a,{get:e,set:f,enumerable:!0,configurable:!0})}}),Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(a){var b=this[a];delete this[a],this[a]=b}}),Array.prototype.min=function(){return Math.min.apply(this,this)},String.prototype.startsWith=String.prototype.startsWith||function(a,b){return b=b||0,this.slice(b,b+a.length)==a},String.prototype.contains=String.prototype.contains||function(){return-1!==String.prototype.indexOf.apply(this,arguments)};var a=function(a){for(var b=0,c=a.length;c>b;++b)if(" "!=a[b]&&"	"!=a[b])return b;return a.length},b=function(a){return a.split(/#|\.|\(|\{| /g)},c=function(a,b){var c=a.indexOf(b);return-1!=c?[a.slice(0,c),a.slice(c+b.length)]:!1},d=function(a,b){for(var c=b.split("."),d=0;d<c.length;++d){if("undefined"==typeof a[c[d]])return!1;a=a[c[d]]}return!0},e=function(a,b){for(var c=b.split("."),d=0;d<c.length;++d)a=a[c[d]];return a},f=function(a){for(var b,c={},d=[],e=0,f=0,g=!1;e<a.length;++e)'"'==a[e]&&(g=!g),","!=a[e]||g||(d.push(a.slice(f,e).trim()),f=e+1);for(d.push(a.slice(f)),e=0;e<d.length;++e)0!==d[e].length&&(f=d[e].split("="),b=f[1].trim(),c[f[0].trim()]=b.slice(1,b.length-1));return c},g=["br","hr","input","img","meta","link","wbr","area"],h=function(a){return"undefined"==typeof a?!1:-1!=g.indexOf(a)},i=document,j=i.createElement.bind(i),k=i.createDocumentFragment.bind(i),l=i.createTextNode.bind(i),m="",n="",o="[[$",p="]]",q=function(a,b,c,d,e,f,g){return b.startsWith("each")||b.startsWith("if")||b.startsWith("else")||a.push(new s(b,g,d,e,f)),a},r=function(a,b,c,d){for(var e,f=c.o.min(),g=[],h=[],i=[],j=0,k=-1,l=0;l<c.l.length;++l)f==c.o[l]?l!==j&&(q(i,c.l[j],c.o[j],a,b,d,{l:g,o:h},e,k),g=[],h=[],j=l):(g.push(c.l[l]),h.push(c.o[l]));return q(i,c.l[j],c.o[j],a,b,d,{l:g,o:h},e,k)},s=function(a,d,e,g,i){this.line=a,this.predefined=i||{},this.defined=[],this.root=g,this.parent=e,this.vars={},this.derived=[];var j,k,l,q,t,u,v;if(this.line.startsWith("logic"))this.node="logic",d.l.length>0&&(this.childs=r(this,g,d));else if(this.line.startsWith("|"))this.node="|",k=this.line.slice(1);else{for(d.l.length>0&&(this.childs=r(this,g,d)),this.line.startsWith("#")||this.line.startsWith(".")?(k=this.line,this.node="DIV"):(j=b(this.line),k=this.line.slice(j[0].length),this.node=j[0].toUpperCase()),this.classes="",this.id="";k.length>0;)if(k.startsWith("#"))j=b(k.slice(1)),k=k.slice(j[0].length+1).trim(),this.id=j[0];else{if(!k[0].startsWith("."))break;j=b(k.slice(1)),k=k.slice(j[0].length+1).trim(),this.classes+=" "+j[0]}if(this.attrs={},k.startsWith("(")){for(q=1;q<k.length&&!k.startsWith(")",q);++q);j=k.slice(1,q).trim(),k=k.slice(q+1),l=f(j);for(t in l)l[t].contains(o)?(u=l[t].split(o)[1].split(p)[0],(this.vars[u]=this.vars[u]||[]).push({type:s.VType.ATTRIBUTE,link:t,inside:l[t]}),this.predefined.hasOwnProperty(u)&&!function(a){{var b=u;l[t]}a.predefined.watch(b,function(){})}(this)):this.attrs[t]=l[t]}if(this.styles={},k.startsWith("{")){for(q=1;q<k.length&&!k.startsWith("}",q);++q);j=k.slice(1,q+1).replace("}","").trim(),k=k.slice(q+2),l=f(j);for(var w in l)l[w].contains(o)?(u=l[w].split(o)[1].split(p)[0],(this.vars[u]=this.vars[u]||[]).push({type:s.VType.STYLE,link:w,inside:l[w]}),this.predefined.hasOwnProperty(u)&&!function(a){{var b=u;l[w]}a.predefined.watch(b,function(){})}(this)):this.styles[w]=l[w]}}if(k.startsWith(" ")&&(k=k.slice(1)),k.length>0&&!h(v)){var x=0;for(this.contents="";j=c(k,o);)this.contents+=j[0],j=c(j[1],p),(this.vars[j[0]]=this.vars[j[0]]||[]).push({type:s.VType.CONTENT,inside:x++}),this.predefined.hasOwnProperty(j[0])?(this.contents+=m+this.predefined[j[0]]+n,function(a){var b=j[0];a.predefined.watch(b,function(c,d,e){return a.render(b,e),e}.bind(a))}(this)):this.contents+=m+o+j[0]+p+n,k=j[1];this.contents+=k}for(var y in this.vars)g.on(y,this.render.bind(this))};s.prototype={render:function(a,b){if("undefined"==typeof a);else if(this.vars.hasOwnProperty(a))for(var c,d=this.vars[a],e=0;e<d.length;++e)if(d[e].type==s.VType.ATTRIBUTE)for(this.attrs[d[e].link]=d[e].inside.replace(o+a+p,b),c=0;c<this.derived.length;++c)this.derived[c].setAttribute(d[e].link,this.attrs[d[e].link]);else if(d[e].type==s.VType.STYLE)for(this.styles[d[e].link]=d[e].inside.replace(o+a+p,b),c=0;c<this.derived.length;++c)this.derived[c].setStyle(d[e].link,this.styles[d[e].link]);else if(d[e].type==s.VType.CONTENT){var f=this.contents,g=m+f.split(m)[d[e].inside+1].split(n)[0]+n;for(this.contents=f.replace(g,m+b+n),c=0;c<this.derived.length;++c)this.derived[c].setContent(f.replace(g,m+b+n))}},build:function(){var a=new u(this);return this.derived.push(a),a}},s.VType={ATTRIBUTE:1,STYLE:2,CONTENT:3};var t=function(b){for(var c=[],d=[],e=b.split("\n"),f=0,g=e.length,h=0,i=-1;g>f;++f)h=a(e[f]),e[f].startsWith("//",h)?i=h:h!==e[f].length&&(-1==i?!0:i>=h)&&(c.push(e[f].trim()),d.push(h),i=-1);this.lines={l:c,o:d},this.listeners={},this.subscription=!1,this.childs=0!==c.length?r(this,this,this.lines):[]};t.prototype={append:function(a){if("undefined"==typeof this.frag){this.frag=k();for(var b=0,c=this.childs.length;c>b;++b)this.frag.appendChild(this.childs[b].build().get())}return this.childs.length>0&&a.appendChild(this.frag),this},remove:function(a){return"undefined"!=typeof this.frag&&a.removeChild(this.frag),this},on:function(a,b){return this.listeners.hasOwnProperty(a)||(this.listeners[a]=[]),this.listeners[a].push(b),this},off:function(a,b){if(this.listeners.hasOwnProperty(a)){var c=this.listeners[a].indexOf(b);-1!=c&&delete this.listeners[a][c]}return this},trigger:function(a,b){if(this.listeners.hasOwnProperty(a))for(var c=0;c<this.listeners[a].length;++c)this.listeners[a][c](a,b);return this},render:function(a){for(var b in this.listeners)d(a,b)&&this.trigger(b,e(a,b));return this},subscribe:function(a){var b,c,d,e,f;if(this.subscription)for(var g in this.listeners){for(f=g.split("."),b=this.subscription,c=this.subscription,d=0;d<f.length;++d){if(!c.hasOwnProperty(f[d])){e=!1;break}b=c,e=!0,c=c[f[d]]}e&&b.unwatch(f[f.length-1])}if(this.subscription=a,this.subscription)for(var h in this.listeners){for(f=h.split("."),b=this.subscription,c=this.subscription,d=0;d<f.length;++d){if(!c.hasOwnProperty(f[d])){e=!1;break}b=c,e=!0,c=c[f[d]]}e&&!function(a){var c=f[f.length-1],d=h;b.watch(c,function(a,b,c){return this.trigger(d,c),c}.bind(a)),a.trigger.apply(a,[d,b[c]])}(this)}return this},unsubscribe:function(){return this.subscribe(!1)}};var u=function(a){if("|"==a.node||"logic"==a.node)this.domElement=k();else{this.domElement=j(a.node),a.id.length>0&&(this.domElement.id=a.id),a.classes.length>0&&(this.domElement.className=a.classes.trim());for(var b in a.attrs)this.setAttribute(b,a.attrs[b]);for(b in a.styles)this.setStyle(b,a.styles[b])}if("undefined"!=typeof a.contents&&(this.textNode=l(""),this.setContent(a.contents),this.domElement.appendChild(this.textNode)),"undefined"!=typeof a.childs)for(var c=0;c<a.childs.length;++c)this.domElement.appendChild(a.childs[c].build().get())};u.prototype={get:function(){return this.domElement},setContent:function(a){this.contents=a,this.textNode.textContent=a.replace(m,"").replace(n,"")},setAttribute:function(a,b){this.domElement.setAttribute(a,b)},setStyle:function(a,b){a=a.split("-");for(var c=0;c<a.length;++c)0!==c&&(a[c]=a[c].slice(0,1).toUpperCase()+a[c].slice(1));this.domElement.style[a.join("")]=b}};var v={compile:function(a,b){var c=new t(a);return"undefined"!=typeof b&&c.subscribe(b),c}};return v});