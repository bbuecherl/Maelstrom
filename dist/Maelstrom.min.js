/**
 * Maelstrom v0.0.1-1403201723
 * https://github.com/bbuecherl/Maelstrom/
 * by Bernhard Buecherl http://bbuecherl.de/
 * License: MIT http://bbuecherl.mit-license.org/ */
!function(a,b){"function"==typeof define&&define.amd?define(["Maelstrom"],b):a.Maelstrom=b()}(this,function(){"use strict";"undefined"!=typeof"".trim&&(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF]+|[\s\uFEFF]+$/g,"")}),Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(a,b){var c=this[a],d=c,e=function(){return d},f=function(e){return c=d,d=b.call(this,a,c,e)};delete this[a]&&Object.defineProperty(this,a,{get:e,set:f,enumerable:!0,configurable:!0})}}),Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(a){var b=this[a];delete this[a],this[a]=b}}),Array.prototype.min=function(){return Math.min.apply(this,this)};var a=document,b=a.createElement.bind(a),c=a.createDocumentFragment.bind(a),d=a.createTextNode.bind(a),e=function(a){for(var b=[],c=[],d=a.split("\n"),e=0,g=d.length,h=0,i=-1;g>e;++e)h=f(d[e]),"/"==d[e].charAt(h)&&"/"==d[e].charAt(h+1)?i=h:h!==d[e].length&&(-1==i?!0:i>=h)&&(b.push(d[e]),c.push(h),i=-1);return{l:b,o:c}},f=function(a){for(var b=0,c=a.length;c>b;++b)if(" "!=a[b]&&"	"!=a[b])return b;return a.length},g=function(a){return a.split(/#|\.|\(|\{| /g)},h=function(a,b){var c=a.indexOf(b);return-1!=c?[a.slice(0,c),a.slice(c+b.length)]:!1},i=function(a,b){for(var c=b.split("."),d=0;d<c.length;++d){if(!a.hasOwnProperty(c[d]))return!1;a=a[c[d]]}return!0},j=function(a,b){for(var c=b.split("."),d=0;d<c.length;++d)a=a[c[d]];return a},k=function(a){for(var b={},c=[],d=0,e=0;d<a.length;++d)","==a[d]&&(c.push(a.slice(e,d).trim()),e=d+1);for(c.push(a.slice(e)),e=d,d=0;d<c.length;++d)0!==c[d].length&&(e=c[d].split("="),b[e[0].trim()]=e[1].trim().slice(1,e[1].length-1).trim());return b},l=function(a,b,c){b=b.split("-");for(var d=0;d<b.length;++d)0!==d&&(b[d]=b[d].slice(0,1).toUpperCase()+b[d].slice(1));a.style[b.join("")]=c},m=["br","hr","input","img","meta","link"],n=function(a){return"undefined"==typeof a?!1:-1!=m.indexOf(a)},o=function(a,b,c){for(var d=c.o.min(),e=[],f=[],g=[],h=0,i=0;i<c.l.length;++i)d==c.o[i]?i!==h&&(g.push(new s(c.l[h],{l:e,o:f},a,b)),e=[],f=[],h=i):(e.push(c.l[i]),f.push(c.o[i]));return g.push(new s(c.l[h],{l:e,o:f},a,b)),g},p={compile:function(a,b){var c=new q(a).create();return"undefined"!=typeof b&&c.subscribe(b),c}},q=function(a){this.lines=e(a)};q.prototype.create=function(){return new r(this.lines)};var r=function(a){this.fragments=[],this.listeners={},this.subscription=!1,this.childs=o(this,this,a)};r.prototype.append=function(a){if("undefined"==typeof this.frag){this.frag=c();for(var b=0,d=this.childs.length;d>b;++b)this.frag.appendChild(this.childs[b].domElement)}return a.appendChild(this.frag),this},r.prototype.remove=function(a){return"undefined"!=typeof this.frag&&a.removeChild(this.frag),this},r.prototype.on=function(a,b){return this.listeners.hasOwnProperty(a)||(this.listeners[a]=[]),this.listeners[a].push(b),this},r.prototype.off=function(a,b){if(this.listeners.hasOwnProperty(a)){var c=this.listeners[a].indexOf(b);-1!=c&&delete this.listeners[a][c]}return this},r.prototype.trigger=function(a,b){if(this.listeners.hasOwnProperty(a))for(var c=0;c<this.listeners[a].length;++c)this.listeners[a][c](b);return this},r.prototype.render=function(a){for(var b in this.listeners)i(a,b)&&this.trigger(b,j(a,b));return this},r.prototype.subscribe=function(a){var b,c,d,e,f;if(this.subscription)for(var g in this.listeners){for(f=g.split("."),b=this.subscription,c=this.subscription,d=0;d<f.length;++d){if(!c.hasOwnProperty(f[d])){e=!1;break}b=c,e=!0,c=c[f[d]]}e&&b.unwatch(f[f.length-1])}if(this.subscription=a,this.subscription){for(var h in this.listeners){for(f=h.split("."),b=this.subscription,c=this.subscription,d=0;d<f.length;++d){if(!c.hasOwnProperty(f[d])){e=!1;break}b=c,e=!0,c=c[f[d]]}e&&!function(a){var c=f[f.length-1],d=h;b.watch(c,function(a,b,c){return this.trigger(d,c),c}.bind(a))}(this)}this.render(this.subscription)}return this},r.prototype.unsubscribe=function(){return this.subscribe(!1)};var s=function(a,e,f,i){this.line=a.trim();var j,m,p,q,r,s,t;if(i.fragments.push(this),"|"==this.line[0])this.domElement=c(),m=this.line.slice(1);else{e.l.length>0&&(this.childs=o(this,i,e)),"#"==this.line[0]?(m=this.line,t="div"):(j=g(this.line),m=this.line.slice(j[0].length),t=j[0].toLowerCase()),this.domElement=b(t);for(var u="";m.length>0;)if("#"==m[0])j=g(m.slice(1)),m=m.slice(j[0].length+1).trim(),this.domElement.id=j[0];else{if("."!=m[0])break;j=g(m.slice(1)),m=m.slice(j[0].length+1).trim(),u+=j[0]}if(0!==u.length&&(this.domElement.className=u.trim()),m.length>0&&"("==m[0]){for(q=1;q<m.length&&")"!=m[q];++q);j=m.slice(1,q).trim(),m=m.slice(q+1),p=k(j);for(r in p)p[r].replace("[[$","").length!=p[r].length?(s=p[r].split("[[$")[1].split("]]")[0],function(a){var b=s,c=r,d=p[c];i.on(s,function(a){this.domElement.setAttribute(c,d.replace("[[$"+b+"]]",a))}.bind(a))}(this)):this.domElement.setAttribute(r,p[r]);this.attrs=j}if(m.length>0&&"{"==m[0]){for(q=1;q<m.length&&"}"!=m[q];++q);j=m.slice(1,q+1).replace("}","").trim(),m=m.slice(q+2),p=k(j);for(var v in p)p[v].replace("[[$","").length!=p[v].length?(s=p[v].split("[[$")[1].split("]]")[0],function(a){var b=s,c=v,d=p[v];i.on(s,function(a){l(this.domElement,c,d.replace("[[$"+b+"]]",a))}.bind(a))}(this)):l(this.domElement,v,p[v]);this.styles=j}}if(m.length>0&&!n(t)){for(;j=h(m,"[[$");)s=d(j[0]),this.domElement.appendChild(s),j=h(j[1],"]]"),s=d("[[$"+j[0]+"]]"),this.domElement.appendChild(s),function(){var a=s,b=j[0];i.on(b,function(b){a.textContent=b})}(),m=j[1];s=d(m),this.domElement.appendChild(s)}if("undefined"!=typeof this.childs)for(q=0;q<this.childs.length;++q)this.domElement.appendChild(this.childs[q].domElement)};return p});
